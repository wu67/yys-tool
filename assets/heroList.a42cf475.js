import{a as D,l as t,e as f,G as ee,o as p,j as T,i as o,w as r,H as te,h as u,I as H,J as ae,m as V,u as le,K as j,g as O,L,p as ne,M,N as oe,O as de,P as F,F as P,k as q,t as k,Q as v,R as U}from"./vendor.b382efbc.js";/* empty css                 *//* empty css                        *//* empty css               *//* empty css                   */import{_ as z,u as se}from"./index.d13b0e3a.js";const re={class:"dialogSetNotIncluded"},ue={class:"flex center"},ie=V("\u4FDD\u5B58"),ce=D({name:"dialogSetNotIncluded"});function fe(B,{emit:x}){const g=B,y=t(g.allHeroList).map(i=>({key:i.id,label:i.name})),R=g.userName,I=function(i){x("update:modelValue",!1),typeof i=="function"&&i()},m=f(g.notIncluded),h=f(!1);ee(()=>{h.value=g.modelValue});const S=()=>{x("change-not-included",t(m).map(i=>parseInt(i))),I(),h.value=!1};return(i,_)=>(p(),T("div",re,[o(t(ae),{title:`\u8BBE\u7F6E\u672A\u6536\u5F55 - ${t(R)}`,modelValue:h.value,"onUpdate:modelValue":_[1]||(_[1]=C=>h.value=C),width:"650px","before-close":I},{default:r(()=>[o(t(te),{style:{margin:"0 auto"},modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=C=>m.value=C),data:t(y),titles:["\u5DF2\u6536\u5F55","\u672A\u6536\u5F55"],filterable:""},null,8,["modelValue","data"]),u("div",ue,[o(t(H),{type:"primary",onClick:S},{default:r(()=>[ie]),_:1})])]),_:1},8,["title","modelValue"])]))}const ve=Object.assign(ce,{props:{notIncluded:{type:Array,default(){return[]}},allHeroList:{type:Array,default(){return[]}},userName:{type:String,default:""},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","change-not-included"],setup:fe});var he=z(ve,[["__scopeId","data-v-09153d62"]]);const me={class:"page-shards-list"},_e={class:"flex between",style:{"margin-bottom":"8px"}},pe=V("\u5168\u90E8"),ge=V("\u6E05\u7A7A\u7A00\u6709\u5EA6"),ye=V("\u91CD\u7F6E\u6240\u6709\u8FC7\u6EE4\u9879"),be={style:{height:"calc(100vh - 172px)"}},Ne={class:"flex center"},Ve=V("\xA0 "),ke=["onClick"],Ie=D({name:"heroList"});function Se(B){const{updateUserNotIncluded:x,getNotIncluded:g}=se(),y=le(),R=j(()=>y.state.allHeroList),I=j(()=>y.state.notIncludedList),m=j(()=>y.state.user.list),h=f([{name:"SP",value:"SP"},{name:"SSR",value:"SSR"},{name:"SR",value:"SR"},{name:"R",value:"R"},{name:"N",value:"N"},{name:"\u7D20\u6750",value:"MATERIAL"},{name:"\u8054\u52A8",value:"INTERACTIVE"}]);let S=f([]),i=f([]);const _=function(){S.value=R.value.sort((l,e)=>e.id-l.id).map(l=>{let e={name:l.name,rarity:l.rarity,id:l.id,shards:[],included:[],have:[],required:0,holdings:0};l.interactive===!0&&(e.interactive=!0),m.value.forEach((n,s)=>{n.data.hero_book_shards.forEach(E=>{e.id===E.hero_id&&(e.bookMaxShards=E.book_max_shards,e.shards[s]=E.shards)}),i[s]=Array.from(new Set(n.data.heroes.map(E=>E.hero_id))),e.included[s]=t(I)[s].indexOf(parseInt(l.id))!==-1?0:1,e.have[s]=i[s].indexOf(parseInt(l.id))!==-1?1:0}),e.holdings=e.shards.reduce((n,s)=>(n+=s,n),0);const a=e.included.reduce((n,s)=>s===0?++n:n,0),d=e.bookMaxShards*a-e.holdings;return e.required=d>0?d:"-",e})},C=function(l){let e="";return h.value.forEach(a=>{a.value==l&&(e=a.name)}),e};let c=f(["SP","SSR"]);const G=j(()=>{let l=[];return c.value.indexOf("INTERACTIVE")!==-1?l=S.value.filter(e=>c.value.indexOf(e.rarity)!==-1||e.interactive):l=S.value.filter(e=>c.value.indexOf(e.rarity)!==-1&&typeof e.interactive=="undefined"),l});let A=f(!0);const J=function(l){c.value=l?h.value.map(e=>e.value):[],A.value=!1};let w=f(!1);const K=function(l){w.value=l.length===h.value.length,A.value=l.length>0&&l.length<h.value.length};let $=f(null);const Q=function(){$.value.clearFilter()},W=function(l,e,a){return l===e.included[a]},X=function(l,e,a){return l===e.have[a]};let b=f(-1),N=f(!1);const Y=function(l){b.value=l,N.value=!0},Z=function(l){y.commit("updateNotIncluded",{index:b.value,value:l}),x(b.value,{id:m.value[b.value].data.player.id,value:t(l)}).then(()=>{F.success("\u8BBE\u7F6E\u672A\u6536\u5F55\u6210\u529F"),_()}).catch(e=>{F.error(e.message||"\u8BBE\u7F6E\u672A\u6536\u5F55\u51FA\u9519")})};return g().then(()=>{_()}),(l,e)=>(p(),T("div",me,[t(N)?(p(),O(he,{key:0,userName:t(m)[t(b)].data.player.name,notIncluded:t(I)[t(b)],allHeroList:t(R),modelValue:t(N),"onUpdate:modelValue":e[0]||(e[0]=a=>L(N)?N.value=a:N=a),onChangeNotIncluded:Z},null,8,["userName","notIncluded","allHeroList","modelValue"])):ne("",!0),u("div",_e,[u("div",null,[o(t(M),{label:"all",modelValue:t(w),"onUpdate:modelValue":e[1]||(e[1]=a=>L(w)?w.value=a:w=a),onChange:J,indeterminate:t(A)},{default:r(()=>[pe]),_:1},8,["modelValue","indeterminate"]),o(t(oe),{onChange:K,modelValue:t(c),"onUpdate:modelValue":e[2]||(e[2]=a=>L(c)?c.value=a:c=a)},{default:r(()=>[(p(!0),T(P,null,q(h.value,a=>(p(),O(t(M),{label:a.value,key:a.value},{default:r(()=>[V(k(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),u("div",null,[o(t(H),{size:"mini",onClick:e[3]||(e[3]=a=>L(c)?c.value=[]:c=[])},{default:r(()=>[ge]),_:1}),o(t(H),{size:"mini",onClick:Q},{default:r(()=>[ye]),_:1})])]),u("div",be,[o(t(de),{data:t(G),"highlight-current-row":"",stripe:"",border:"",height:"100%",ref:(a,d)=>{d.shardTableRef=a,L($)?$.value=a:$=a},style:{width:"100%"}},{default:r(()=>[o(t(v),{type:"index",width:"50"}),o(t(v),{prop:"id",label:"ID",width:"80"}),o(t(v),{prop:"name",label:"\u540D\u79F0",width:"110"}),o(t(v),{label:"\u7A00\u6709\u5EA6",width:"80"},{default:r(a=>[u("div",{class:U(["rarity",`${a.row.rarity}`])},k(C(a.row.rarity)),3)]),_:1}),(p(!0),T(P,null,q(t(m),(a,d)=>(p(),O(t(v),{align:"center",label:`${a.data.player.name}`,key:`userColumn${d}`},{header:r(()=>[u("div",Ne,[u("div",null,k(a.data.player.name),1),Ve,u("div",{class:"btnSetNotIncluded",onClick:n=>Y(d)},"\u8BBE\u7F6E\u672A\u6536\u5F55",8,ke)])]),default:r(()=>[o(t(v),{label:"\u6301\u6709\u788E\u7247",key:`shard${d}`},{default:r(n=>[u("div",null,k(n.row.shards[d]),1)]),_:2},1024),o(t(v),{filters:[{text:"\u5DF2\u6536\u5F55",value:1},{text:"\u672A\u6536\u5F55",value:0}],"filter-method":(n,s)=>W(n,s,d),label:"\u6536\u5F55\u72B6\u6001",key:`included${d}`},{default:r(n=>[u("div",{class:U({"not-included":n.row.included[d]===0})},k(n.row.included[d]===1?"":"\u672A\u6536\u5F55"),3)]),_:2},1032,["filter-method"]),o(t(v),{filters:[{text:"\u4ED3\u5E93\u4E2D\u6709",value:1},{text:"\u4ED3\u5E93\u4E2D\u65E0",value:0}],"filter-method":(n,s)=>X(n,s,d),label:"\u4ED3\u68C0",key:`have${d}`},{default:r(n=>[u("div",{class:U({"have-not":n.row.have[d]===0})},k(n.row.have[d]===1?"":"\u4ED3\u5E93\u4E2D\u65E0"),3)]),_:2},1032,["filter-method"])]),_:2},1032,["label"]))),128)),o(t(v),{prop:"name",label:"\u540D\u79F0",width:"110"}),o(t(v),{label:"\u5171\u6709\u788E\u7247",prop:"holdings",width:"80"}),o(t(v),{label:"\u4ECD\u7F3A",prop:"required",width:"80"})]),_:1},8,["data"])])]))}const Ce=Object.assign(Ie,{setup:Se});var Te=z(Ce,[["__scopeId","data-v-1a2ea10e"]]);export{Te as default};
