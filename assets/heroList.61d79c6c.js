import{d as P,A as n,c as f,B as ae,C as le,G as ne,o as b,k as O,j as o,w as s,i,m as S,H as q,u as oe,I as j,J as de,K as se,L as re,M as ue,h as D,N as L,n as ie,O as z,F as G,l as J,t as C,P as M}from"./vendor.a886f0fc.js";/* empty css                 *//* empty css               */import{_ as K,u as ce}from"./index.962e05da.js";const _e={class:"dialogSetNotIncluded"},ve={class:"flex center"},fe=S("\u4FDD\u5B58"),he=P({name:"dialogSetNotIncluded"});function me(F,{emit:R}){const N=F,k=n(N.allHeroList).map(c=>({key:c.id,label:c.name})),$=N.userName,w=function(c){R("update:modelValue",!1),typeof c=="function"&&c()},m=f(N.notIncluded),h=f(!1);ae(()=>{h.value=N.modelValue});const x=()=>{R("change-not-included",n(m).map(c=>parseInt(c))),w(),h.value=!1};return(c,p)=>{const B=le,r=q,H=ne;return b(),O("div",_e,[o(H,{title:`\u8BBE\u7F6E\u672A\u6536\u5F55 - ${n($)}`,modelValue:h.value,"onUpdate:modelValue":p[1]||(p[1]=g=>h.value=g),width:"650px","before-close":w},{default:s(()=>[o(B,{style:{margin:"0 auto"},modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=g=>m.value=g),data:n(k),titles:["\u5DF2\u6536\u5F55","\u672A\u6536\u5F55"],filterable:""},null,8,["modelValue","data"]),i("div",ve,[o(r,{type:"primary",onClick:x},{default:s(()=>[fe]),_:1})])]),_:1},8,["title","modelValue"])])}}const pe=Object.assign(he,{props:{notIncluded:{type:Array,default(){return[]}},allHeroList:{type:Array,default(){return[]}},userName:{type:String,default:""},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","change-not-included"],setup:me});var ge=K(pe,[["__scopeId","data-v-121ae00c"]]);const ye={class:"page-shards-list"},be={class:"flex between",style:{"margin-bottom":"8px"}},Ne=S("\u5168\u90E8"),ke=S("\u6E05\u7A7A\u7A00\u6709\u5EA6"),Ve=S("\u91CD\u7F6E\u6240\u6709\u8FC7\u6EE4\u9879"),Ie={style:{height:"calc(100vh - 172px)"}},Se={class:"flex center"},Ce=S("\xA0 "),we=["onClick"],xe=P({name:"heroList"});function Ee(F){const{updateUserNotIncluded:R,getNotIncluded:N}=ce(),k=oe(),$=j(()=>k.state.allHeroList),w=j(()=>k.state.notIncludedList),m=j(()=>k.state.user.list),h=f([{name:"SP",value:"SP"},{name:"SSR",value:"SSR"},{name:"SR",value:"SR"},{name:"R",value:"R"},{name:"N",value:"N"},{name:"\u7D20\u6750",value:"MATERIAL"},{name:"\u8054\u52A8",value:"INTERACTIVE"}]);let x=f([]),c=f([]);const p=function(){x.value=$.value.sort((t,e)=>e.id-t.id).map(t=>{let e={name:t.name,rarity:t.rarity,id:t.id,shards:[],included:[],have:[],required:0,holdings:0};t.interactive===!0&&(e.interactive=!0),m.value.forEach((v,l)=>{v.data.hero_book_shards.forEach(y=>{e.id===y.hero_id&&(e.bookMaxShards=y.book_max_shards,e.shards[l]=y.shards)}),c[l]=Array.from(new Set(v.data.heroes.map(y=>y.hero_id))),e.included[l]=n(w)[l].indexOf(parseInt(t.id))!==-1?0:1,e.have[l]=c[l].indexOf(parseInt(t.id))!==-1?1:0}),e.holdings=e.shards.reduce((v,l)=>(v+=l,v),0);const _=e.included.reduce((v,l)=>l===0?++v:v,0),A=e.bookMaxShards*_-e.holdings;return e.required=A>0?A:"-",e})},B=function(t){let e="";return h.value.forEach(_=>{_.value==t&&(e=_.name)}),e};let r=f(["SP","SSR"]);const H=j(()=>{let t=[];return r.value.indexOf("INTERACTIVE")!==-1?t=x.value.filter(e=>r.value.indexOf(e.rarity)!==-1||e.interactive):t=x.value.filter(e=>r.value.indexOf(e.rarity)!==-1&&typeof e.interactive=="undefined"),t});let g=f(!0);const Q=function(t){r.value=t?h.value.map(e=>e.value):[],g.value=!1};let E=f(!1);const W=function(t){E.value=t.length===h.value.length,g.value=t.length>0&&t.length<h.value.length};let T=f(null);const X=function(){T.value.clearFilter()},Y=function(t,e,_){return t===e.included[_]},Z=function(t,e,_){return t===e.have[_]};let V=f(-1),I=f(!1);const ee=function(t){V.value=t,I.value=!0},te=function(t){k.commit("updateNotIncluded",{index:V.value,value:t}),R(V.value,{id:m.value[V.value].data.player.id,value:n(t)}).then(()=>{z.success("\u8BBE\u7F6E\u672A\u6536\u5F55\u6210\u529F"),p()}).catch(e=>{z.error(e.message||"\u8BBE\u7F6E\u672A\u6536\u5F55\u51FA\u9519")})};return N().then(()=>{p()}),(t,e)=>{const _=de,A=se,v=q,l=re,y=ue;return b(),O("div",ye,[n(I)?(b(),D(ge,{key:0,userName:n(m)[n(V)].data.player.name,notIncluded:n(w)[n(V)],allHeroList:n($),modelValue:n(I),"onUpdate:modelValue":e[0]||(e[0]=a=>L(I)?I.value=a:I=a),onChangeNotIncluded:te},null,8,["userName","notIncluded","allHeroList","modelValue"])):ie("",!0),i("div",be,[i("div",null,[o(_,{label:"all",modelValue:n(E),"onUpdate:modelValue":e[1]||(e[1]=a=>L(E)?E.value=a:E=a),onChange:Q,indeterminate:n(g)},{default:s(()=>[Ne]),_:1},8,["modelValue","indeterminate"]),o(A,{onChange:W,modelValue:n(r),"onUpdate:modelValue":e[2]||(e[2]=a=>L(r)?r.value=a:r=a)},{default:s(()=>[(b(!0),O(G,null,J(h.value,a=>(b(),D(_,{label:a.value,key:a.value},{default:s(()=>[S(C(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",null,[o(v,{size:"mini",onClick:e[3]||(e[3]=a=>L(r)?r.value=[]:r=[])},{default:s(()=>[ke]),_:1}),o(v,{size:"mini",onClick:X},{default:s(()=>[Ve]),_:1})])]),i("div",Ie,[o(y,{data:n(H),"highlight-current-row":"",stripe:"",border:"",height:"100%",ref:(a,d)=>{d.shardTableRef=a,L(T)?T.value=a:T=a},style:{width:"100%"}},{default:s(()=>[o(l,{type:"index",width:"50"}),o(l,{prop:"id",label:"ID",width:"80"}),o(l,{prop:"name",label:"\u540D\u79F0",width:"110"}),o(l,{label:"\u7A00\u6709\u5EA6",width:"80"},{default:s(a=>[i("div",{class:M(["rarity",`${a.row.rarity}`])},C(B(a.row.rarity)),3)]),_:1}),(b(!0),O(G,null,J(n(m),(a,d)=>(b(),D(l,{align:"center",label:`${a.data.player.name}`,key:`userColumn${d}`},{header:s(()=>[i("div",Se,[i("div",null,C(a.data.player.name),1),Ce,i("div",{class:"btnSetNotIncluded",onClick:u=>ee(d)},"\u8BBE\u7F6E\u672A\u6536\u5F55",8,we)])]),default:s(()=>[o(l,{label:"\u6301\u6709\u788E\u7247",key:`shard${d}`},{default:s(u=>[i("div",null,C(u.row.shards[d]),1)]),_:2},1024),o(l,{filters:[{text:"\u5DF2\u6536\u5F55",value:1},{text:"\u672A\u6536\u5F55",value:0}],"filter-method":(u,U)=>Y(u,U,d),label:"\u6536\u5F55\u72B6\u6001",key:`included${d}`},{default:s(u=>[i("div",{class:M({"not-included":u.row.included[d]===0})},C(u.row.included[d]===1?"":"\u672A\u6536\u5F55"),3)]),_:2},1032,["filter-method"]),o(l,{filters:[{text:"\u4ED3\u5E93\u4E2D\u6709",value:1},{text:"\u4ED3\u5E93\u4E2D\u65E0",value:0}],"filter-method":(u,U)=>Z(u,U,d),label:"\u4ED3\u68C0",key:`have${d}`},{default:s(u=>[i("div",{class:M({"have-not":u.row.have[d]===0})},C(u.row.have[d]===1?"":"\u4ED3\u5E93\u4E2D\u65E0"),3)]),_:2},1032,["filter-method"])]),_:2},1032,["label"]))),128)),o(l,{prop:"name",label:"\u540D\u79F0",width:"110"}),o(l,{label:"\u5171\u6709\u788E\u7247",prop:"holdings",width:"80"}),o(l,{label:"\u4ECD\u7F3A",prop:"required",width:"80"})]),_:1},8,["data"])])])}}const Le=Object.assign(xe,{setup:Ee});var Oe=K(Le,[["__scopeId","data-v-67532c54"]]);export{Oe as default};
