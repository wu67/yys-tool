import{a as D,l as t,e as u,G as ee,o as _,j as $,i as o,w as r,H as te,h as i,I as H,J as ae,m as N,u as le,K as T,g as V,L as A,p as ne,M,N as de,O as oe,P as F,F as P,k as q,t as S,Q as f,R as U}from"./vendor.41670513.js";import{_ as z,u as se}from"./index.00d2ce6a.js";const re={class:"dialogSetNotIncluded"},ue={class:"flex center"},ie=N(" \u4FDD\u5B58 "),ce=D({name:"DialogSetNotIncluded"}),ve=Object.assign(ce,{props:{notIncluded:{type:Array,default(){return[]}},allHeroList:{type:Array,default(){return[]}},userName:{type:String,default:""},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","change-not-included"],setup(j,{emit:L}){const g=j,y=t(g.allHeroList).map(c=>({key:c.id,label:c.name})),R=u(g.userName.value),C=function(c){L("update:modelValue",!1),typeof c=="function"&&c()},m=u(g.notIncluded),h=u(!1);ee(()=>{h.value=g.modelValue});const I=()=>{L("change-not-included",t(m).map(c=>parseInt(c))),C(),h.value=!1};return(c,p)=>(_(),$("div",re,[o(t(ae),{modelValue:h.value,"onUpdate:modelValue":p[1]||(p[1]=w=>h.value=w),title:`\u8BBE\u7F6E\u672A\u6536\u5F55 - ${R.value}`,width:"650px","before-close":C},{default:r(()=>[o(t(te),{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=w=>m.value=w),style:{margin:"0 auto"},data:t(y),titles:["\u5DF2\u6536\u5F55","\u672A\u6536\u5F55"],filterable:""},null,8,["modelValue","data"]),i("div",ue,[o(t(H),{type:"primary",onClick:I},{default:r(()=>[ie]),_:1})])]),_:1},8,["modelValue","title"])]))}});var fe=z(ve,[["__scopeId","data-v-392838eb"]]);const he={class:"page-shards-list"},_e={class:"flex between",style:{"margin-bottom":"8px"}},me=N(" \u5168\u90E8 "),pe=N(" \u6E05\u7A7A\u7A00\u6709\u5EA6 "),ge=N(" \u91CD\u7F6E\u6240\u6709\u8FC7\u6EE4\u9879 "),ye={style:{height:"calc(100vh - 172px)"}},be={class:"flex center"},ke=N(" \xA0 "),Ne=["onClick"],Ve=D({name:"HeroList"}),Se=Object.assign(Ve,{setup(j){const{updateUserNotIncluded:L,getNotIncluded:g}=se(),y=le(),R=T(()=>y.state.allHeroList),C=T(()=>y.state.notIncludedList),m=T(()=>y.state.user.list),h=u([{name:"SP",value:"SP"},{name:"SSR",value:"SSR"},{name:"SR",value:"SR"},{name:"R",value:"R"},{name:"N",value:"N"},{name:"\u7D20\u6750",value:"MATERIAL"},{name:"\u8054\u52A8",value:"INTERACTIVE"}]);let I=u([]),c=u([]);const p=function(){I.value=R.value.sort((a,e)=>e.id-a.id).map(a=>{let e={name:a.name,rarity:a.rarity,id:a.id,shards:[],included:[],have:[],required:0,holdings:0};a.interactive===!0&&(e.interactive=!0),m.value.forEach((n,s)=>{n.data.hero_book_shards.forEach(x=>{e.id===x.hero_id&&(e.bookMaxShards=x.book_max_shards,e.shards[s]=x.shards)}),c[s]=Array.from(new Set(n.data.heroes.map(x=>x.hero_id))),e.included[s]=t(C)[s].indexOf(parseInt(a.id))!==-1?0:1,e.have[s]=c[s].indexOf(parseInt(a.id))!==-1?1:0}),e.holdings=e.shards.reduce((n,s)=>(n+=s,n),0);const l=e.included.reduce((n,s)=>s===0?++n:n,0),d=e.bookMaxShards*l-e.holdings;return e.required=d>0?d:"-",e})},w=function(a){let e="";return h.value.forEach(l=>{l.value==a&&(e=l.name)}),e};let v=u(["SP","SSR"]);const G=T(()=>{let a=[];return v.value.indexOf("INTERACTIVE")!==-1?a=I.value.filter(e=>v.value.indexOf(e.rarity)!==-1||e.interactive):a=I.value.filter(e=>v.value.indexOf(e.rarity)!==-1&&typeof e.interactive=="undefined"),a});let O=u(!0);const J=function(a){v.value=a?h.value.map(e=>e.value):[],O.value=!1};let E=u(!1);const K=function(a){E.value=a.length===h.value.length,O.value=a.length>0&&a.length<h.value.length};let B=u(null);const Q=function(){B.value.clearFilter()},W=function(a,e,l){return a===e.included[l]},X=function(a,e,l){return a===e.have[l]};let b=u(-1),k=u(!1);const Y=function(a){b.value=a,k.value=!0},Z=function(a){y.commit("updateNotIncluded",{index:b.value,value:a}),L(b.value,{id:m.value[b.value].data.player.id,value:t(a)}).then(()=>{F.success("\u8BBE\u7F6E\u672A\u6536\u5F55\u6210\u529F"),p()}).catch(e=>{F.error(e.message||"\u8BBE\u7F6E\u672A\u6536\u5F55\u51FA\u9519")})};return g().then(()=>{p()}),(a,e)=>(_(),$("div",he,[t(k)?(_(),V(fe,{key:0,modelValue:t(k),"onUpdate:modelValue":e[0]||(e[0]=l=>A(k)?k.value=l:k=l),"user-name":t(m)[t(b)].data.player.name,"not-included":t(C)[t(b)],"all-hero-list":t(R),onChangeNotIncluded:Z},null,8,["modelValue","user-name","not-included","all-hero-list"])):ne("",!0),i("div",_e,[i("div",null,[o(t(M),{modelValue:t(E),"onUpdate:modelValue":e[1]||(e[1]=l=>A(E)?E.value=l:E=l),label:"all",indeterminate:t(O),onChange:J},{default:r(()=>[me]),_:1},8,["modelValue","indeterminate"]),o(t(de),{modelValue:t(v),"onUpdate:modelValue":e[2]||(e[2]=l=>A(v)?v.value=l:v=l),onChange:K},{default:r(()=>[(_(!0),$(P,null,q(h.value,l=>(_(),V(t(M),{key:l.value,label:l.value},{default:r(()=>[N(S(l.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",null,[o(t(H),{size:"mini",onClick:e[3]||(e[3]=l=>A(v)?v.value=[]:v=[])},{default:r(()=>[pe]),_:1}),o(t(H),{size:"mini",onClick:Q},{default:r(()=>[ge]),_:1})])]),i("div",ye,[o(t(oe),{ref_key:"shardTableRef",ref:B,data:t(G),"highlight-current-row":"",stripe:"",border:"",height:"100%",style:{width:"100%"}},{default:r(()=>[o(t(f),{type:"index",width:"50"}),o(t(f),{prop:"id",label:"ID",width:"80"}),o(t(f),{prop:"name",label:"\u540D\u79F0",width:"110"}),o(t(f),{label:"\u7A00\u6709\u5EA6",width:"80"},{default:r(l=>[i("div",{class:U(["rarity",`${l.row.rarity}`])},S(w(l.row.rarity)),3)]),_:1}),(_(!0),$(P,null,q(t(m),(l,d)=>(_(),V(t(f),{key:`userColumn${d}`,align:"center",label:`${l.data.player.name}`},{header:r(()=>[i("div",be,[i("div",null,S(l.data.player.name),1),ke,i("div",{class:"btnSetNotIncluded",onClick:n=>Y(d)}," \u8BBE\u7F6E\u672A\u6536\u5F55 ",8,Ne)])]),default:r(()=>[(_(),V(t(f),{key:`shard${d}`,label:"\u6301\u6709\u788E\u7247"},{default:r(n=>[i("div",null,S(n.row.shards[d]),1)]),_:2},1024)),(_(),V(t(f),{key:`included${d}`,filters:[{text:"\u5DF2\u6536\u5F55",value:1},{text:"\u672A\u6536\u5F55",value:0}],"filter-method":(n,s)=>W(n,s,d),label:"\u6536\u5F55\u72B6\u6001"},{default:r(n=>[i("div",{class:U({"not-included":n.row.included[d]===0})},S(n.row.included[d]===1?"":"\u672A\u6536\u5F55"),3)]),_:2},1032,["filter-method"])),(_(),V(t(f),{key:`have${d}`,filters:[{text:"\u4ED3\u5E93\u4E2D\u6709",value:1},{text:"\u4ED3\u5E93\u4E2D\u65E0",value:0}],"filter-method":(n,s)=>X(n,s,d),label:"\u4ED3\u68C0"},{default:r(n=>[i("div",{class:U({"have-not":n.row.have[d]===0})},S(n.row.have[d]===1?"":"\u4ED3\u5E93\u4E2D\u65E0"),3)]),_:2},1032,["filter-method"]))]),_:2},1032,["label"]))),128)),o(t(f),{prop:"name",label:"\u540D\u79F0",width:"110"}),o(t(f),{label:"\u5171\u6709\u788E\u7247",prop:"holdings",width:"80"}),o(t(f),{label:"\u4ECD\u7F3A",prop:"required",width:"80"})]),_:1},8,["data"])])]))}});var we=z(Se,[["__scopeId","data-v-41bbaf49"]]);export{we as default};
